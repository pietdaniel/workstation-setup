---
# macOS-specific system settings, window manager, and hotkeys

# Install yabai, skhd, and pinentry-mac
- name: Add koekeishiya tap (yabai/skhd)
  become: no
  community.general.homebrew_tap:
    name: koekeishiya/formulae
    state: present

- name: Install yabai, skhd, and pinentry-mac
  become: no
  community.general.homebrew:
    name:
      - koekeishiya/formulae/yabai
      - koekeishiya/formulae/skhd
      - pinentry-mac
    state: present

# Symlink dotfiles
- name: Symlink macos dotfiles
  ansible.builtin.include_tasks: "{{ playbook_dir }}/roles/common/tasks/symlink_dotfiles.yaml"

# System settings
- name: Set keyboard preferences (Caps Lock <-> Escape swap)
  ansible.builtin.command: >
    hidutil property --set '{"UserKeyMapping":[{"HIDKeyboardModifierMappingSrc":0x700000039,"HIDKeyboardModifierMappingDst":0x700000029},{"HIDKeyboardModifierMappingSrc":0x700000029,"HIDKeyboardModifierMappingDst":0x700000039}]}'
  changed_when: false

- name: Configure Dock (left, autohide, small icons)
  become: no
  ansible.builtin.shell: |
    defaults write com.apple.dock orientation -string left
    defaults write com.apple.dock autohide -bool true
    defaults write com.apple.dock tilesize -int 16
    killall Dock
  changed_when: false

- name: GPG pinentry-mac Use Keychain
  become: no
  ansible.builtin.command: >
    defaults write org.gpgtools.pinentry-mac DisableKeychain -bool no
  changed_when: false
